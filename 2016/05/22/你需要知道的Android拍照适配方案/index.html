<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>你需要知道的Android拍照适配方案 | 技术视界</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="近段时间，家里陪自己度过大学四年的电脑坏了，挑选好的新电脑配件终于在本周全部到货，自己动手完成组装。从AMD到i7的CPU，6G内存到14G内存，打开 AndroidStudio 的速度终于杠杆的上去了，感动到泪流满面啊！！！！！！！扯了这么多，回归一下正题，还是来说说本篇文章要写什么吧！说起调用系统相机来拍照的功能，大家肯定不陌生，现在所有应用都具备这个功能。例如最基本的，用户拍照上传头像。An">
<meta property="og:type" content="article">
<meta property="og:title" content="你需要知道的Android拍照适配方案">
<meta property="og:url" content="http://blog.coderclock.com/2016/05/22/你需要知道的Android拍照适配方案/index.html">
<meta property="og:site_name" content="技术视界">
<meta property="og:description" content="近段时间，家里陪自己度过大学四年的电脑坏了，挑选好的新电脑配件终于在本周全部到货，自己动手完成组装。从AMD到i7的CPU，6G内存到14G内存，打开 AndroidStudio 的速度终于杠杆的上去了，感动到泪流满面啊！！！！！！！扯了这么多，回归一下正题，还是来说说本篇文章要写什么吧！说起调用系统相机来拍照的功能，大家肯定不陌生，现在所有应用都具备这个功能。例如最基本的，用户拍照上传头像。An">
<meta property="og:image" content="https://diycode.b0.upaiyun.com/photo/2017/2b54aba0b223f9710721c4f3593439e7.png">
<meta property="og:image" content="https://diycode.b0.upaiyun.com/photo/2017/3244e1d3dd698e8478a9a0b47d56e8e2.png">
<meta property="og:image" content="https://diycode.b0.upaiyun.com/photo/2017/0e568cbd11a31f9816a8e71faa198ab6.png">
<meta property="og:image" content="https://diycode.b0.upaiyun.com/photo/2017/989e100b66d219acc6159f38bbe7cf2f.png">
<meta property="og:image" content="https://diycode.b0.upaiyun.com/photo/2017/0f1a8aa132c0d25f0783409d0108028b.png">
<meta property="og:image" content="https://diycode.b0.upaiyun.com/photo/2017/a0b60574ffd30bd693f4fcc1986352cd.png">
<meta property="og:image" content="https://diycode.b0.upaiyun.com/photo/2017/8e1cb72808ceb55be3aa16276fb6bb15.png">
<meta property="og:image" content="https://diycode.b0.upaiyun.com/photo/2017/0bad791d4a3dfc460661d904c7aa01d0.png">
<meta property="og:image" content="https://diycode.b0.upaiyun.com/photo/2017/80c72b3f1aa625f4f7fe10475a36faf4.png">
<meta property="og:updated_time" content="2017-02-22T14:13:51.762Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="你需要知道的Android拍照适配方案">
<meta name="twitter:description" content="近段时间，家里陪自己度过大学四年的电脑坏了，挑选好的新电脑配件终于在本周全部到货，自己动手完成组装。从AMD到i7的CPU，6G内存到14G内存，打开 AndroidStudio 的速度终于杠杆的上去了，感动到泪流满面啊！！！！！！！扯了这么多，回归一下正题，还是来说说本篇文章要写什么吧！说起调用系统相机来拍照的功能，大家肯定不陌生，现在所有应用都具备这个功能。例如最基本的，用户拍照上传头像。An">
<meta name="twitter:image" content="https://diycode.b0.upaiyun.com/photo/2017/2b54aba0b223f9710721c4f3593439e7.png">
  
    <link rel="alternate" href="/atom.xml" title="技术视界" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
    
  
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">

	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  	ga('create', 'UA-91393761-2', 'auto');
  	ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
	<!-- 百度统计 -->
	<script type="text/javascript">
		var _hmt = _hmt || [];
		(function() {
 			var hm = document.createElement("script");
  			hm.src = "https://hm.baidu.com/hm.js?9e8a7a9cb9edac601fdb29f1394bc51e";
			var s = document.getElementsByTagName("script")[0]; 
  			s.parentNode.insertBefore(hm, s);
		})();
	</script>

  
	<!-- CNZZ统计 -->
	<script type="text/javascript">
		var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
		document.write(unescape("%3Cspan id='cnzz_stat_icon_1261297942'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1261297942%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));
	</script>

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    
    <div id="header-inner" class="inner">
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.coderclock.com"></form>
      </div>
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      
    </div>
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">技术视界</a>
      </h1>
      
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-你需要知道的Android拍照适配方案" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/05/22/你需要知道的Android拍照适配方案/" class="article-date">
  <time datetime="2016-05-21T16:00:00.000Z" itemprop="datePublished">2016-05-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      你需要知道的Android拍照适配方案
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>近段时间，家里陪自己度过大学四年的电脑坏了，挑选好的新电脑配件终于在本周全部到货，自己动手完成组装。从AMD到i7的CPU，6G内存到14G内存，打开 AndroidStudio 的速度终于杠杆的上去了，感动到泪流满面啊！！！！！！！扯了这么多，回归一下正题，还是来说说本篇文章要写什么吧！说起调用系统相机来拍照的功能，大家肯定不陌生，现在所有应用都具备这个功能。例如最基本的，用户拍照上传头像。Android开发的孩纸都知道，碎片化给拍照这个功能的实现带来挺多头疼的问题。<strong>所以，我决定写写一些网上不多见但又经常听到童鞋们吐槽的问题。</strong></p>
<a id="more"></a>
<h2 id="拍照功能实现"><a href="#拍照功能实现" class="headerlink" title="拍照功能实现"></a>拍照功能实现</h2><p>Android 程序上实现拍照功能的方式分为两种：第一种是利用相机的 API 来自定义相机，第二种是利用 Intent 调用系统指定的相机拍照。下面讲的内容都是针对第二种实现方式的适配。</p>
<p>通常情况下，我们调用拍照的业务场景是如下面这样的：</p>
<ol>
<li>A 界面，点击按钮调用相机拍照；</li>
<li>A 界面得到拍完照片，跳转到 B 界面进行预览；</li>
<li>B 界面有个按钮，点击后触发某个业务流程来处理这张照片；</li>
</ol>
<p>实现的大体流程代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">//1、调用相机</span></div><div class="line">File mPhotoFile = <span class="keyword">new</span> File(folder,filename);</div><div class="line">Intent captureIntent = <span class="keyword">new</span> Intent(MediaStore.ACTION_IMAGE_CAPTURE);</div><div class="line">Uri fileUri = Uri.fromFile(mPhotoFile);</div><div class="line">captureIntent.putExtra(MediaStore.EXTRA_OUTPUT, fileUri);</div><div class="line">mActivity.startActivityForResult(captureIntent, CAPTURE_PHOTO_REQUEST_CODE);</div><div class="line"></div><div class="line"><span class="comment">//2、拿到照片</span></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onActivityResult</span><span class="params">(<span class="keyword">int</span> requestCode, <span class="keyword">int</span> resultCode, Intent data)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (requestCode == CapturePhotoHelper.CAPTURE_PHOTO_REQUEST_CODE &amp;&amp; resultCode == RESULT_OK) &#123;</div><div class="line">        File photoFile = mCapturePhotoHelper.getPhoto();<span class="comment">//获取拍完的照片</span></div><div class="line">        <span class="keyword">if</span> (photoFile != <span class="keyword">null</span>) &#123;</div><div class="line">            PhotoPreviewActivity.preview(<span class="keyword">this</span>, photoFile);<span class="comment">//跳转到预览界面</span></div><div class="line">        &#125;</div><div class="line">        finish();</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">super</span>.onActivityResult(requestCode, resultCode, data);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//3、各种各样处理这张图片的业务代码</span></div></pre></td></tr></table></figure>
<p>到这里基本科普完了如何调用系统相机拍照，相信这些网上一搜一大把的代码，很多童鞋都能看懂。</p>
<h2 id="有没有相机可用？"><a href="#有没有相机可用？" class="headerlink" title="有没有相机可用？"></a>有没有相机可用？</h2><p>前面讲到我们是调用系统指定的相机app来拍照，那么系统是否存在可以被我们调用的app呢？这个我们不敢确定，毕竟 Android 奇葩问题多，还真有遇到过这种极端的情况导致闪退的。虽然很极端，但作为客户端人员还是要进行处理，方式有二：</p>
<ol>
<li>调用相机时，简单粗暴的 try-catch</li>
<li>调用相机前，检测系统有没有相机 app 可用</li>
</ol>
<p>try-catch 这种粗暴的方式大家肯定很熟悉了，那么要如何检测系统有没有相机 app 可用呢？系统在  PackageManager 里为我们提供这样一个 API</p>
<p><img src="https://diycode.b0.upaiyun.com/photo/2017/2b54aba0b223f9710721c4f3593439e7.png" alt=""></p>
<p>通过这样一个 API ，可以知道系统是否存在 action 为 MediaStore.ACTION_IMAGE_CAPTURE 的 intent 可以唤起的拍照界面，具体实现代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 判断系统中是否存在可以启动的相机应用</div><div class="line"> *</div><div class="line"> * <span class="doctag">@return</span> 存在返回true，不存在返回false</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasCamera</span><span class="params">()</span> </span>&#123;</div><div class="line">    PackageManager packageManager = mActivity.getPackageManager();</div><div class="line">    Intent intent = <span class="keyword">new</span> Intent(MediaStore.ACTION_IMAGE_CAPTURE);</div><div class="line">    List&lt;ResolveInfo&gt; list = packageManager.queryIntentActivities(intent, PackageManager.MATCH_DEFAULT_ONLY);</div><div class="line">    <span class="keyword">return</span> list.size() &gt; <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="拍出来的照片“歪了”！！！"><a href="#拍出来的照片“歪了”！！！" class="headerlink" title="拍出来的照片“歪了”！！！"></a>拍出来的照片“歪了”！！！</h2><p>经常会遇到一种情况，拍照时看到照片是正的，但是当我们的 app 获取到这张照片时，却发现旋转了 90 度（也有可能是180、270，不过90度比较多见，貌似都是由于手机传感器导致的）。很多童鞋对此感到很困扰，因为不是所有手机都会出现这种情况，就算会是出现这种情况的手机上，也并非每次必现。要怎么解决这个问题呢？从解决的思路上看，只要获取到照片旋转的角度，利用 Matrix 来进行角度纠正即可。<strong>那么问题来了，要怎么知道照片旋转的角度呢？</strong>细心的童鞋可能会发现，拍完一张照片去到相册点击属性查看，能看到下面这样一堆关于照片的属性数据</p>
<p><img src="https://diycode.b0.upaiyun.com/photo/2017/3244e1d3dd698e8478a9a0b47d56e8e2.png" alt=""></p>
<p>没错，这里面就有一个旋转角度，倘若拍照后保存的成像照片文件发生了角度旋转，这个图片的属性参数就能告诉我们到底旋转了多少度。只要获取到这个角度值，我们就能进行纠正的工作了。 Android 系统提供了 ExifInterface 类来满足获取图片各个属性的操作</p>
<p><img src="https://diycode.b0.upaiyun.com/photo/2017/0e568cbd11a31f9816a8e71faa198ab6.png" alt=""></p>
<p>通过 ExifInterface 类拿到 TAG_ORIENTATION 属性对应的值，即为我们想要得到旋转角度。再根据利用 Matrix 进行旋转纠正即可。实现代码大致如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 获取图片的旋转角度</div><div class="line"> *</div><div class="line"> * <span class="doctag">@param</span> path 图片绝对路径</div><div class="line"> * <span class="doctag">@return</span> 图片的旋转角度</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getBitmapDegree</span><span class="params">(String path)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> degree = <span class="number">0</span>;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        <span class="comment">// 从指定路径下读取图片，并获取其EXIF信息</span></div><div class="line">        ExifInterface exifInterface = <span class="keyword">new</span> ExifInterface(path);</div><div class="line">        <span class="comment">// 获取图片的旋转信息</span></div><div class="line">        <span class="keyword">int</span> orientation = exifInterface.getAttributeInt(ExifInterface.TAG_ORIENTATION, ExifInterface.ORIENTATION_NORMAL);</div><div class="line">        <span class="keyword">switch</span> (orientation) &#123;</div><div class="line">            <span class="keyword">case</span> ExifInterface.ORIENTATION_ROTATE_90:</div><div class="line">                degree = <span class="number">90</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> ExifInterface.ORIENTATION_ROTATE_180:</div><div class="line">                degree = <span class="number">180</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> ExifInterface.ORIENTATION_ROTATE_270:</div><div class="line">                degree = <span class="number">270</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">        e.printStackTrace();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> degree;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 将图片按照指定的角度进行旋转</div><div class="line"> *</div><div class="line"> * <span class="doctag">@param</span> bitmap 需要旋转的图片</div><div class="line"> * <span class="doctag">@param</span> degree 指定的旋转角度</div><div class="line"> * <span class="doctag">@return</span> 旋转后的图片</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">rotateBitmapByDegree</span><span class="params">(Bitmap bitmap, <span class="keyword">int</span> degree)</span> </span>&#123;</div><div class="line">    <span class="comment">// 根据旋转角度，生成旋转矩阵</span></div><div class="line">    Matrix matrix = <span class="keyword">new</span> Matrix();</div><div class="line">    matrix.postRotate(degree);</div><div class="line">    <span class="comment">// 将原始图片按照旋转矩阵进行旋转，并得到新的图片</span></div><div class="line">    Bitmap newBitmap = Bitmap.createBitmap(bitmap, <span class="number">0</span>, <span class="number">0</span>, bitmap.getWidth(), bitmap.getHeight(), matrix, <span class="keyword">true</span>);</div><div class="line">    <span class="keyword">if</span> (bitmap != <span class="keyword">null</span> &amp;&amp; !bitmap.isRecycled()) &#123;</div><div class="line">        bitmap.recycle();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> newBitmap;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ExifInterface 能拿到的信息远远不止旋转角度，其他的参数感兴趣的童鞋可以看看 API 文档。</p>
<h2 id="拍完照怎么闪退了？"><a href="#拍完照怎么闪退了？" class="headerlink" title="拍完照怎么闪退了？"></a>拍完照怎么闪退了？</h2><p>曾在小米和魅族的某些机型上遇到过这样的问题，调用系统相机拍照，拍完点击确定回到自己的app里面却莫名奇妙的闪退了。这种闪退有两个特点：</p>
<ol>
<li>没有什么错误日志（有些机子啥日志都没有，有些机子会出来个空异常错误日志）；</li>
<li>同个机子上非必现（有时候怎么拍都不闪退，有时候一拍就闪退）；</li>
</ol>
<p>对待非必现问题往往比较头疼，当初遇到这样的问题也是非常不解。上网搜罗了一圈也没方案，后来留意到一个比较有意思信息：<strong>有些系统厂商的 ROM 会给自带相机应用做优化，当某个 app 通过 intent 进入相机拍照界面时，系统会把这个 app 当前最上层的 Activity 销毁回收。（注意：我遇到的情况是有时候很快就回收掉，有时候怎么等也不回收，没有什么必现规律）</strong>为了验证一下，便在启动相机的 Activity 中对 onDestory 方法进行加 log 。果不其然，终于发现进入拍照界面的时候 onDestory 方法被执行了。所以，前面提到的闪退基本可以推测是 Activity 被回收导致某些非UI控件的成员变量为空导致的。（有些机子会报出空异常错误日志，但是有些机子闪退了什么都不报，是不是觉得很奇葩！）</p>
<p>既然涉及到 Activity 被回收的问题，自然要想起 onSaveInstanceState 和 onRestoreInstanceState 这对方法。去到 onSaveInstanceState 把数据保存，并在 onRestoreInstanceState 方法中进行恢复即可。大体代码思路如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onSaveInstanceState</span><span class="params">(Bundle outState)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onSaveInstanceState(outState);</div><div class="line">    mRestorePhotoFile = mCapturePhotoHelper.getPhoto();</div><div class="line">    <span class="keyword">if</span> (mRestorePhotoFile != <span class="keyword">null</span>) &#123;</div><div class="line">        outState.putSerializable(EXTRA_RESTORE_PHOTO, mRestorePhotoFile);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onRestoreInstanceState</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onRestoreInstanceState(savedInstanceState);</div><div class="line">    mRestorePhotoFile = (File) savedInstanceState.getSerializable(EXTRA_RESTORE_PHOTO);</div><div class="line">    mCapturePhotoHelper.setPhoto(mRestorePhotoFile);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>对于  onSaveInstanceState 和 onRestoreInstanceState 方法的作用还不熟悉的童鞋，网上资料很多，可以自行搜索。</p>
<p>到这里，可能有童鞋要问，这种闪退并不能保证复现，我要怎么知道问题所在和是否修复了呢？我们可以去到开发者选项里开启<strong>不保留活动</strong>这一项进行调试验证</p>
<p><img src="https://diycode.b0.upaiyun.com/photo/2017/989e100b66d219acc6159f38bbe7cf2f.png" alt=""></p>
<p>它作用是保留当前和用户接触的 Activity ，并将目前无法和用户交互 Activity 进行销毁回收。打开这个调试选项就可以满足验证的需求，当你的 app 的某个 Activity 跳转到拍照的 Activity 后，这个 Activity 立马就会被系统销毁回收，这样就可以很好的完全复现闪退的场景，帮助开发者确认问题有没有修复了。</p>
<p>涉及到 Activity 被销毁，还想提一下代码实现上的问题。假设当前有两个 Activity ，MainActivity 中有个 Button ，点击可以调用系统相机拍照并显示到 PreviewActivity 进行预览。有下面两种实现方案：</p>
<ul>
<li>方案一：MainActivity 中点击 Button 后，启动系统相机拍照，并在 MainActivity 的 onActivityResult 方法中获取拍下来的照片，并启动跳转到 PreviewActivity 界面进行效果预览；</li>
<li>方案二：MainActivity 中点击 Button 后，启动 PreviewActivity 界面，在 PreviewActivity 的 onCreate（或者onStart、onResume）方法中启动系统相机拍照，然后在 PreviewActivity 的 onActivityResult 方法中获取拍下来的照片进行预览；</li>
</ul>
<p>上面两种方案得到的实现效果是一模一样的，但是第二种方案却存在很大的问题。因为启动相机的代码放在 onCreate（或者onStart、onResume）中，当进入拍照界面后，PreviewActivity 随即被销毁，拍完照确认后回到 PreviewActivity 时，被销毁的 PreviewActivity 需要重建，又要走一遍 onCreate、onStart、onResume，又调用了启动相机拍照的代码，周而复始的进入了死循环状态。<strong>为了避免让你的用户抓狂，果断明智的选择方案一。</strong></p>
<p>以上这种情况提到调用系统拍照时，Activity就回收的情况，在<strong>小米4S</strong>和<strong>小米4 LTE</strong>机子上<strong>（MIUI的版本是7.3，Android系统版本是6.0）</strong>出现的概率很高。 所以，建议看到此文的童鞋也可以去验证适配一下。</p>
<h2 id="图片无法显示"><a href="#图片无法显示" class="headerlink" title="图片无法显示"></a>图片无法显示</h2><p>图片无法显示这个问题也是略坑，如何坑法？往下看，同样是在<strong>小米4S</strong>和<strong>小米4 LTE</strong>机子上<strong>（MIUI的版本是7.3，Android系统版本是6.0）</strong>出现概率很高的场景（当然，不保证其他机子没出现过）。按照我们前面提到的业务场景，调用相机拍照完成后，我们的 app 会有一个预览图片的界面。但是在用了小米的机子进行拍照后，自己 app 的预览界面却怎么也无法显示出照片来，同样是相当郁闷，郁闷完后还是要一步一步去排查解决问题的！为此，需要一步一步猜测验证问题所在。</p>
<ul>
<li>猜测一：没有拿到照片路径，所以无法显示？</li>
</ul>
<p>直接断点打 log 跟踪，猜测一很快被推翻，路径是有的。</p>
<ul>
<li>猜测二：Bitmap太大了，无法显示？</li>
</ul>
<p>直接在 AS 的 log 控制台仔细的观察了一下系统 log ，发现了一些蛛丝马迹</p>
<p><img src="https://diycode.b0.upaiyun.com/photo/2017/0f1a8aa132c0d25f0783409d0108028b.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">OpenGLRenderer: Bitmap too large to be uploaded into a texture</div></pre></td></tr></table></figure>
<p>每次拍完照片，都会出现上面这样的 log ，果然，因为图片太大而导致在 ImageView 上无法显示。到这里有童鞋要吐槽了，没对图片的采样率 <strong>inSampleSize</strong> 做处理？天地良心啊，绝对做处理了，直接看代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 压缩Bitmap的大小</div><div class="line"> *</div><div class="line"> * <span class="doctag">@param</span> imagePath     图片文件路径</div><div class="line"> * <span class="doctag">@param</span> requestWidth  压缩到想要的宽度</div><div class="line"> * <span class="doctag">@param</span> requestHeight 压缩到想要的高度</div><div class="line"> * <span class="doctag">@return</span></div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">decodeBitmapFromFile</span><span class="params">(String imagePath, <span class="keyword">int</span> requestWidth, <span class="keyword">int</span> requestHeight)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (!TextUtils.isEmpty(imagePath)) &#123;</div><div class="line">        <span class="keyword">if</span> (requestWidth &lt;= <span class="number">0</span> || requestHeight &lt;= <span class="number">0</span>) &#123;</div><div class="line">            Bitmap bitmap = BitmapFactory.decodeFile(imagePath);</div><div class="line">            <span class="keyword">return</span> bitmap;</div><div class="line">        &#125;</div><div class="line">        BitmapFactory.Options options = <span class="keyword">new</span> BitmapFactory.Options();</div><div class="line">        options.inJustDecodeBounds = <span class="keyword">true</span>;<span class="comment">//不加载图片到内存，仅获得图片宽高</span></div><div class="line">        BitmapFactory.decodeFile(imagePath, options);</div><div class="line">        options.inSampleSize = calculateInSampleSize(options, requestWidth, requestHeight); <span class="comment">//计算获取新的采样率</span></div><div class="line">        options.inJustDecodeBounds = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">return</span> BitmapFactory.decodeFile(imagePath, options);</div><div class="line"></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">calculateInSampleSize</span><span class="params">(BitmapFactory.Options options, <span class="keyword">int</span> reqWidth, <span class="keyword">int</span> reqHeight)</span> </span>&#123;</div><div class="line">    <span class="keyword">final</span> <span class="keyword">int</span> height = options.outHeight;</div><div class="line">    <span class="keyword">final</span> <span class="keyword">int</span> width = options.outWidth;</div><div class="line">    <span class="keyword">int</span> inSampleSize = <span class="number">1</span>;</div><div class="line">    Log.i(TAG, <span class="string">"height: "</span> + height);</div><div class="line">    Log.i(TAG, <span class="string">"width: "</span> + width);</div><div class="line">    <span class="keyword">if</span> (height &gt; reqHeight || width &gt; reqWidth) &#123;</div><div class="line"></div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> halfHeight = height / <span class="number">2</span>;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> halfWidth = width / <span class="number">2</span>;</div><div class="line"></div><div class="line">        <span class="keyword">while</span> ((halfHeight / inSampleSize) &gt; reqHeight &amp;&amp; (halfWidth / inSampleSize) &gt; reqWidth) &#123;</div><div class="line">            inSampleSize *= <span class="number">2</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">long</span> totalPixels = width * height / inSampleSize;</div><div class="line"></div><div class="line">        <span class="keyword">final</span> <span class="keyword">long</span> totalReqPixelsCap = reqWidth * reqHeight * <span class="number">2</span>;</div><div class="line"></div><div class="line">        <span class="keyword">while</span> (totalPixels &gt; totalReqPixelsCap) &#123;</div><div class="line">            inSampleSize *= <span class="number">2</span>;</div><div class="line">            totalPixels /= <span class="number">2</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> inSampleSize;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>瞄了代码后，是不是觉得没有问题了？没错，inSampleSize 确确实实经过处理，那为什么图片还是太大而显示不出来呢？ requestWidth、int requestHeight 设置得太大导致 inSampleSize 太小了？不可能啊，我都试着把长宽都设置成 100 了还是没法显示！干脆，直接打印 inSampleSize 值，一打印，inSampleSize 值居然为 1 。 我去，彻底打脸了，明明说好的处理过了，居然还是 <strong>1</strong> ！！！！为了一探究竟，干脆加 log 。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">decodeBitmapFromFile</span><span class="params">(String imagePath, <span class="keyword">int</span> requestWidth, <span class="keyword">int</span> requestHeight)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (!TextUtils.isEmpty(imagePath)) &#123;</div><div class="line">        Log.i(TAG, <span class="string">"requestWidth: "</span> + requestWidth);</div><div class="line">        Log.i(TAG, <span class="string">"requestHeight: "</span> + requestHeight);</div><div class="line">        <span class="keyword">if</span> (requestWidth &lt;= <span class="number">0</span> || requestHeight &lt;= <span class="number">0</span>) &#123;</div><div class="line">            Bitmap bitmap = BitmapFactory.decodeFile(imagePath);</div><div class="line">            <span class="keyword">return</span> bitmap;</div><div class="line">        &#125;</div><div class="line">        BitmapFactory.Options options = <span class="keyword">new</span> BitmapFactory.Options();</div><div class="line">        options.inJustDecodeBounds = <span class="keyword">true</span>;<span class="comment">//不加载图片到内存，仅获得图片宽高</span></div><div class="line">        BitmapFactory.decodeFile(imagePath, options);</div><div class="line">        Log.i(TAG, <span class="string">"original height: "</span> + options.outHeight);</div><div class="line">        Log.i(TAG, <span class="string">"original width: "</span> + options.outWidth);</div><div class="line">        options.inSampleSize = calculateInSampleSize(options, requestWidth, requestHeight); <span class="comment">//计算获取新的采样率</span></div><div class="line">        Log.i(TAG, <span class="string">"inSampleSize: "</span> + options.inSampleSize);</div><div class="line">        options.inJustDecodeBounds = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">return</span> BitmapFactory.decodeFile(imagePath, options);</div><div class="line"></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行打印出来的日志如下：</p>
<p><img src="https://diycode.b0.upaiyun.com/photo/2017/a0b60574ffd30bd693f4fcc1986352cd.png" alt=""></p>
<p>图片原来的宽高居然都是 -1 ，真是奇葩了！难怪，inSampleSize 经过处理之后结果还是 1 。狠狠的吐槽了之后，总是要回来解决问题的。那么，图片的宽高信息都丢失了，我去哪里找啊？ 像下面这样？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">decodeBitmapFromFile</span><span class="params">(String imagePath, <span class="keyword">int</span> requestWidth, <span class="keyword">int</span> requestHeight)</span> </span>&#123;</div><div class="line">        ...</div><div class="line">        BitmapFactory.Options options = <span class="keyword">new</span> BitmapFactory.Options();</div><div class="line">        options.inJustDecodeBounds = <span class="keyword">true</span>;<span class="comment">//不加载图片到内存，仅获得图片宽高</span></div><div class="line">        Bitmap bitmap = BitmapFactory.decodeFile(imagePath, options);</div><div class="line">        bitmap.getWidth();</div><div class="line">        bitmap.getHeight();</div><div class="line">        ...</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>no，此方案行不通，inJustDecodeBounds = true 时，BitmapFactory 获得 Bitmap 对象是 null；那要怎样才能获图片的宽高呢？前面提到的 ExifInterface 再次帮了我们大忙，通过它的下面两个属性即可拿到图片真正的宽高</p>
<p><img src="https://diycode.b0.upaiyun.com/photo/2017/8e1cb72808ceb55be3aa16276fb6bb15.png" alt=""></p>
<p>顺手吐槽一下，为什么高不是 TAG_IMAGE_HEIGHT 而是 TAG_IMAGE_LENGTH。改良过后的代码实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">decodeBitmapFromFile</span><span class="params">(String imagePath, <span class="keyword">int</span> requestWidth, <span class="keyword">int</span> requestHeight)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (!TextUtils.isEmpty(imagePath)) &#123;</div><div class="line">        Log.i(TAG, <span class="string">"requestWidth: "</span> + requestWidth);</div><div class="line">        Log.i(TAG, <span class="string">"requestHeight: "</span> + requestHeight);</div><div class="line">        <span class="keyword">if</span> (requestWidth &lt;= <span class="number">0</span> || requestHeight &lt;= <span class="number">0</span>) &#123;</div><div class="line">            Bitmap bitmap = BitmapFactory.decodeFile(imagePath);</div><div class="line">            <span class="keyword">return</span> bitmap;</div><div class="line">        &#125;</div><div class="line">        BitmapFactory.Options options = <span class="keyword">new</span> BitmapFactory.Options();</div><div class="line">        options.inJustDecodeBounds = <span class="keyword">true</span>;<span class="comment">//不加载图片到内存，仅获得图片宽高</span></div><div class="line">        BitmapFactory.decodeFile(imagePath, options);</div><div class="line">        Log.i(TAG, <span class="string">"original height: "</span> + options.outHeight);</div><div class="line">        Log.i(TAG, <span class="string">"original width: "</span> + options.outWidth);</div><div class="line">        <span class="keyword">if</span> (options.outHeight == -<span class="number">1</span> || options.outWidth == -<span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                ExifInterface exifInterface = <span class="keyword">new</span> ExifInterface(imagePath);</div><div class="line">                <span class="keyword">int</span> height = exifInterface.getAttributeInt(ExifInterface.TAG_IMAGE_LENGTH, ExifInterface.ORIENTATION_NORMAL);<span class="comment">//获取图片的高度</span></div><div class="line">                <span class="keyword">int</span> width = exifInterface.getAttributeInt(ExifInterface.TAG_IMAGE_WIDTH, ExifInterface.ORIENTATION_NORMAL);<span class="comment">//获取图片的宽度</span></div><div class="line">                Log.i(TAG, <span class="string">"exif height: "</span> + height);</div><div class="line">                Log.i(TAG, <span class="string">"exif width: "</span> + width);</div><div class="line">                options.outWidth = width;</div><div class="line">                options.outHeight = height;</div><div class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        options.inSampleSize = calculateInSampleSize(options, requestWidth, requestHeight); <span class="comment">//计算获取新的采样率</span></div><div class="line">        Log.i(TAG, <span class="string">"inSampleSize: "</span> + options.inSampleSize);</div><div class="line">        options.inJustDecodeBounds = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">return</span> BitmapFactory.decodeFile(imagePath, options);</div><div class="line"></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>再看一下，打印出来的log</p>
<p><img src="https://diycode.b0.upaiyun.com/photo/2017/0bad791d4a3dfc460661d904c7aa01d0.png" alt=""></p>
<p>这样就可以解决问题啦。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以上总结了这么些身边童鞋经常问起，但网上又不多见的适配问题，希望可以帮到一些开发童鞋少走弯路。文中多次提到小米的机子，并不代表只有MIUI上有这样的问题存在，仅仅只是因为我身边带的几部机子大都是小米的。对待适配问题，在搜索引擎都无法提供多少有效的信息时，我们只能靠断点、打log、观察控制台的日志、以及API文档来寻找一些蛛丝马迹作为突破口，相信办法总比困难多。</p>
<p>以上的示例代码已经整理到：<a href="https://github.com/D-clock/AndroidStudyCode" target="_blank" rel="external">https://github.com/D-clock/AndroidStudyCode</a> ，主要的代码在下面红圈部分</p>
<p><img src="https://diycode.b0.upaiyun.com/photo/2017/80c72b3f1aa625f4f7fe10475a36faf4.png" alt=""></p>
<p>感兴趣的童鞋可以自行查看！如有错误，欢迎大家指正！</p>
<h2 id="打个广告"><a href="#打个广告" class="headerlink" title="打个广告"></a>打个广告</h2><p>最近 <a href="http://diycode.cc/" target="_blank" rel="external">diycode 社区</a> 上，越来越多开发小伙伴活跃在上面。看着有意思的提问，有意思的回答，我的感触还是蛮大的，曾经渴望过有这样一个优雅问答的技术社区存在，目前在一点点的实现！希望能够它能够越做越好！喜欢开发的小伙伴也可以一起上来 <a href="http://diycode.cc/" target="_blank" rel="external">http://diycode.cc/</a> 探讨交流！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.coderclock.com/2016/05/22/你需要知道的Android拍照适配方案/" data-id="cizh74df3000adketwxoqc8qu" class="article-share-link">分享</a>
      
        <a href="http://blog.coderclock.com/2016/05/22/你需要知道的Android拍照适配方案/#ds-thread" class="article-comment-link">留言</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/拍照/">拍照</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/适配/">适配</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/07/04/那些值得你试试的Android竞品分析工具/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          那些值得你试试的Android竞品分析工具
        
      </div>
    </a>
  
  
    <a href="/2016/04/17/关于 Android 进程保活，你所需要知道的一切/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">关于 Android 进程保活，你所需要知道的一切</div>
    </a>
  
</nav>

  
</article>

      <div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="2016/05/22/你需要知道的Android拍照适配方案/" data-title="你需要知道的Android拍照适配方案" data-url="http://blog.coderclock.com/2016/05/22/你需要知道的Android拍照适配方案/"></div>
	<!-- 多说评论框 end -->
</div>


</section>
           
    <aside id="sidebar">
  
    

  
    
  
    
    <div class="widget-wrap">
    
      <div class="widget" id="toc-widget-fixed">
      
        <strong class="toc-title">文章目录</strong>
        <div class="toc-widget-list">
              <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#拍照功能实现"><span class="toc-number">1.</span> <span class="toc-text">拍照功能实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#有没有相机可用？"><span class="toc-number">2.</span> <span class="toc-text">有没有相机可用？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#拍出来的照片“歪了”！！！"><span class="toc-number">3.</span> <span class="toc-text">拍出来的照片“歪了”！！！</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#拍完照怎么闪退了？"><span class="toc-number">4.</span> <span class="toc-text">拍完照怎么闪退了？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#图片无法显示"><span class="toc-number">5.</span> <span class="toc-text">图片无法显示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">6.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#打个广告"><span class="toc-number">7.</span> <span class="toc-text">打个广告</span></a></li></ol>
          </div>
      </div>
    </div>

  
    

  
    
  
    
  
    


  
    

  
    

  
</aside>

      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-left">
      &copy; 2014 - 2017 D_clock爱吃葱花&nbsp;|&nbsp;
      主题 <a href="https://github.com/giscafer/hexo-theme-cafe/" target="_blank">Cafe</a>
    </div>
     <div id="footer-right">
      联系方式&nbsp;|&nbsp;d_clock@qq.com
    </div>
  </div>
</footer>
 <script src="/jquery/jquery.min.js"></script>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="/about" class="mobile-nav-link">关于</a>
  
</nav>
    <img class="back-to-top-btn" src="/images/fly-to-top.png"/>
<script>
// Elevator script included on the page, already.
window.onload = function() {
  var elevator = new Elevator({
    selector:'.back-to-top-btn',
    element: document.querySelector('.back-to-top-btn'),
    duration: 1000 // milliseconds
  });
}
</script>
    


    	<script type="text/javascript">
        var duoshuoQuery = {short_name:"clockblog"};
      </script>
      <script src="/duoshuo/embed.js"></script>


 <script src="/js/is.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/elevator.js"></script>
  </div>
</body>
</html>